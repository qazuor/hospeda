---
import Badge from '@/components/common/Badge.astro';
import Card from '@/components/common/Card.astro';
import CardContent from '@/components/common/CardContent.astro';
import MapPinIcon from '@/components/icons/MapPinIcon.astro';
import StarIcon from '@/components/icons/StarIcon.astro';
import { FavoriteButton } from '@/components/shared/FavoriteButton.client';
import { getDestinationUrl, getLangFromUrl, useTranslations } from '@/utils';
import { DestinationType } from '@repo/types';

interface Props {
    destination: DestinationType;
}

const { destination } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const url = getDestinationUrl(destination);
---

<Card
    class='relative overflow-hidden hover:shadow-lg dark:hover:shadow-xl dark:hover:shadow-gray-900/20 transition-all duration-300 group cursor-pointer h-full border border-gray-200 dark:border-gray-700 shadow-sm dark:shadow-gray-900/10 bg-white dark:bg-gray-800'
>
    <a
        href={url}
        class='block h-full focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900 rounded-md'
        aria-label={`View destination: ${destination.name}`}
    >
        <div class='relative'>
            <img
                src={destination.media?.featuredImage?.url || '/placeholder.svg'}
                alt={destination.name}
                class='w-full h-32 sm:h-40 lg:h-44 object-cover group-hover:scale-105 group-hover:brightness-110 dark:group-hover:brightness-125 transition-all duration-500 ease-out'
            />
            <div class='absolute top-2 left-2'>
                <Badge
                    color='secondary'
                    class='bg-white/90 dark:bg-gray-900/90 text-gray-800 dark:text-gray-200 text-xs px-2 py-0.5 group-hover:bg-white dark:group-hover:bg-gray-900 group-hover:shadow-md transition-all duration-300'
                >
                    {destination.country?.name}
                </Badge>
            </div>

            {/* Nombre sobre la imagen */}
            <div
                class='absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/100 to-transparent group-hover:from-black/80 p-3 pt-20 transition-all duration-300'
            >
                <h3 class='font-semibold text-sm sm:text-base text-white line-clamp-1 leading-tight'>
                    {destination.name}
                </h3>
                <div class='flex items-center text-white/90 text-xs mt-0.5'>
                    <MapPinIcon class='w-3 h-3 mr-1 flex-shrink-0' />
                    <span class='truncate'>{destination.region?.name}</span>
                </div>
            </div>
        </div>

        <CardContent class='p-3 group-hover:bg-gray-50/50 dark:group-hover:bg-gray-700/50 transition-all duration-300'>
            <div class='space-y-2'>
                {/* Descripci√≥n */}
                <p class='text-xs text-gray-600 dark:text-gray-300 line-clamp-2 leading-relaxed'>
                    {destination.summary}
                </p>

                {/* Rating */}
                <div class='flex items-center gap-1'>
                    {
                        Array.from({ length: 5 }).map((_, i) => (
                            <StarIcon
                                class={`w-3 h-3 ${i < (destination.averageRating ?? 0) ? 'fill-yellow-400 text-yellow-400' : 'text-gray-300 dark:text-gray-600'}`}
                            />
                        ))
                    }
                    <span class='text-xs text-gray-600 dark:text-gray-400 ml-1'>
                        ({destination.reviewsCount ?? destination.reviews?.length ?? 0})
                    </span>
                </div>

                {/* Accommodations count */}
                <div class='text-xs text-gray-500 dark:text-gray-400'>
                    {destination.accommodationsCount ?? 0} accommodations available
                </div>
            </div>
        </CardContent>
    </a>

    <div class='absolute right-2 top-2 z-20'>
        <FavoriteButton
            client:only
            entityId={destination.id}
            entityType='DESTINATION'
            initialBookmarked={false}
            size={20}
        />
    </div>
</Card>
