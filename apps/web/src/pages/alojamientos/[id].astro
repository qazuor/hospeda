---
import DynamicRating from '../../components/DynamicRating';
import { getAllAccommodations } from '../../data/accommodations';
import Layout from '../../layouts/Layout.astro';
import type { Accommodation } from '../../types/Accommodation';
import { formatPrice } from '../../utils/utils';

export const prerender = true;

export async function getStaticPaths() {
    const accommodations: Accommodation[] = getAllAccommodations() || [];
    if (accommodations.length === 0) {
        throw new Error(`No accommodations found`);
    }
    return accommodations.map((accommodation: Accommodation) => ({
        params: { id: String(accommodation.id) },
        props: {
            accommodation: accommodation,
        },
    }));
}

const { accommodation } = Astro.props;

if (!accommodation) {
    throw new Error(`Accommodation no encontrado para esta ruta`);
}
---

<Layout title={accommodation.title}>
    <div class='container mx-auto px-4 py-8'>
        <div class='mb-8'>
            <h1 class='mb-2 text-3xl'>{accommodation.title}</h1>
            <div class='flex items-center justify-between'>
                <p class='dark:text-gray-300 text-gray-600'>{accommodation.location}</p>
                <div class='flex items-center text-accent-500'>
                    <DynamicRating client:load id={accommodation.id} initialRating='0' initialReviews={0} />
                </div>
            </div>
        </div>

        <div class='gap-4 grid grid-cols-2 mb-8'>
            <div class='col-span-2 h-96 md:col-span-1'>
                <img
                    src={accommodation.images![0]}
                    alt={accommodation.title}
                    class='h-full object-cover rounded-lg w-full'
                />
            </div>
            <div class='col-span-2 gap-4 grid grid-cols-2 md:col-span-1'>
                {
                    accommodation
                        .images!.slice(1, 3)
                        .map((image) => (
                            <img src={image} alt={accommodation.title} class='h-full object-cover rounded-lg w-full' />
                        ))
                }
            </div>
        </div>

        <div class='gap-8 grid grid-cols-1 lg:grid-cols-3'>
            <div class='lg:col-span-2'>
                <div class='mb-8'>
                    <h2 class='font-bold mb-4 text-2xl'>Descripción</h2>
                    <p class='dark:text-gray-300 text-gray-600'>{accommodation.description}</p>
                </div>

                <div class='mb-8'>
                    <h2 class='font-bold mb-4 text-2xl'>Características</h2>
                    <div class='gap-4 grid grid-cols-2 md:grid-cols-3'>
                        <div class='flex items-center'>
                            <span class='bg-primary-100 dark:bg-primary-900 mr-2 p-2 rounded-full text-primary-600'>
                                <svg
                                    xmlns='http://www.w3.org/2000/svg'
                                    class='h-5 w-5'
                                    viewBox='0 0 20 20'
                                    fill='currentColor'
                                >
                                    <path
                                        d='M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z'
                                    ></path>
                                </svg>
                            </span>
                            <span class='dark:text-gray-300 text-gray-600'
                                >Hasta {accommodation.maxGuests} huéspedes</span
                            >
                        </div>
                        <div class='flex items-center'>
                            <span class='bg-primary-100 dark:bg-primary-900 mr-2 p-2 rounded-full text-primary-600'>
                                <svg
                                    xmlns='http://www.w3.org/2000/svg'
                                    class='h-5 w-5'
                                    viewBox='0 0 20 20'
                                    fill='currentColor'
                                >
                                    <path
                                        d='M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z'
                                    ></path>
                                </svg>
                            </span>
                            <span class='dark:text-gray-300 text-gray-600'>{accommodation.bedrooms} habitaciones</span>
                        </div>
                        <div class='flex items-center'>
                            <span class='bg-primary-100 dark:bg-primary-900 mr-2 p-2 rounded-full text-primary-600'>
                                <svg
                                    xmlns='http://www.w3.org/2000/svg'
                                    class='h-5 w-5'
                                    viewBox='0 0 20 20'
                                    fill='currentColor'
                                >
                                    <path
                                        fill-rule='evenodd'
                                        d='M7 2a1 1 0 00-.707 1.707L7 4.414v3.758a1 1 0 01-.293.707l-4 4C.817 14.769 2.156 18 4.828 18h10.344c2.672 0 4.011-3.231 2.122-5.121l-4-4A1 1 0 0113 8.172V4.414l.707-.707A1 1 0 0013 2H7zm2 6.172V4h2v4.172a3 3 0 00.879 2.12l1.027 1.028a4 4 0 00-2.171.102l-.47.156a4 4 0 01-2.53 0l-.563-.187a1.993 1.993 0 00-.114-.035l1.063-1.063A3 3 0 009 8.172z'
                                        clip-rule='evenodd'></path>
                                </svg>
                            </span>
                            <span class='dark:text-gray-300 text-gray-600'>{accommodation.bathrooms} baños</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h2 class='font-bold mb-4 text-2xl'>Servicios</h2>
                    <div class='gap-4 grid grid-cols-2 md:grid-cols-3'>
                        {
                            accommodation.features.map((feature) => (
                                <div class='flex items-center'>
                                    <span class='bg-primary-100 dark:bg-primary-900 mr-2 p-2 rounded-full text-primary-600'>
                                        <svg
                                            xmlns='http://www.w3.org/2000/svg'
                                            class='h-5 w-5'
                                            viewBox='0 0 20 20'
                                            fill='currentColor'
                                        >
                                            <path
                                                fill-rule='evenodd'
                                                d='M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z'
                                                clip-rule='evenodd'
                                            />
                                        </svg>
                                    </span>
                                    <span class='dark:text-gray-300 text-gray-600'>{feature}</span>
                                </div>
                            ))
                        }
                    </div>
                </div>
            </div>

            <div class='lg:col-span-1'>
                <div class='bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg sticky top-24'>
                    <div class='border-b border-gray-200 dark:border-gray-700 mb-6 pb-6'>
                        <div class='flex items-center justify-between'>
                            <div>
                                <span class='dark:text-white font-bold text-2xl text-gray-900'
                                    >{formatPrice(accommodation.price)}</span
                                >
                                <span class='dark:text-gray-400 text-gray-600 text-sm'> / noche</span>
                            </div>
                            <DynamicRating client:load id={accommodation.id} initialRating='0' initialReviews={0} />
                        </div>
                    </div>

                    <form class='space-y-4'>
                        <div class='grid grid-cols-2 gap-4'>
                            <div>
                                <label
                                    for='check-in'
                                    class='block dark:text-gray-300 font-medium mb-1 text-gray-700 text-sm'
                                    >Llegada</label
                                >
                                <input
                                    type='date'
                                    id='check-in'
                                    class='bg-white border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:border-primary-500 focus:ring-primary-500 px-4 py-2 rounded-lg text-gray-900 w-full'
                                />
                            </div>
                            <div>
                                <label
                                    for='check-out'
                                    class='block dark:text-gray-300 font-medium mb-1 text-gray-700 text-sm'
                                    >Salida</label
                                >
                                <input
                                    type='date'
                                    id='check-out'
                                    class='bg-white border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:border-primary-500 focus:ring-primary-500 px-4 py-2 rounded-lg text-gray-900 w-full'
                                />
                            </div>
                        </div>

                        <div>
                            <label for='guests' class='block dark:text-gray-300 font-medium mb-1 text-gray-700 text-sm'
                                >Huéspedes</label
                            >
                            <select
                                id='guests'
                                class='bg-white border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:border-primary-500 focus:ring-primary-500 px-4 py-2 rounded-lg text-gray-900 w-full'
                            >
                                {
                                    Array.from(Array(accommodation.maxGuests), (_, i) => (
                                        <option value={i + 1}>
                                            {i + 1} huésped{i !== 0 ? 'es' : ''}
                                        </option>
                                    ))
                                }
                            </select>
                        </div>

                        <button
                            type='submit'
                            class='bg-primary-500 font-medium hover:bg-primary-600 px-4 py-3 rounded-lg text-white transition w-full'
                        >
                            Reservar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</Layout>
