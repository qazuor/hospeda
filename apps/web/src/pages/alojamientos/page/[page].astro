---
import AccommodationListPage from '@/components/pages/AccommodationListPage.astro';
import { getAccommodations } from '@/data/db/accommodation';
import { getAccommodationsIndexUrl } from '@/utils/urls';

const { page: pageParam } = Astro.params;
const page = Number(pageParam) || 1;

// Redirect page 1 to the main index
if (page === 1) {
    return Astro.redirect(getAccommodationsIndexUrl());
}

// Check if page is out of bounds
const { total } = await getAccommodations({
    locals: Astro.locals,
    page: 1,
    pageSize: 12,
});
const totalPages = Math.ceil(total / 12);

if (page > totalPages && totalPages > 0) {
    return Astro.redirect(getAccommodationsIndexUrl());
}
---

<AccommodationListPage page={page} locals={Astro.locals} />
