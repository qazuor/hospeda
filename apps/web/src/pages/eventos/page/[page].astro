---
import EventListPage from '@/components/pages/EventListPage.astro';
import { getEvents } from '@/data/db/events';
import { getEventsIndexUrl } from '@/utils/urls';

const { page: pageParam } = Astro.params;
const page = Number(pageParam) || 1;

// Redirect page 1 to the main index
if (page === 1) {
    return Astro.redirect(getEventsIndexUrl());
}

// Check if page is out of bounds
const { total } = await getEvents({
    locals: Astro.locals,
    page: 1,
    pageSize: 12,
});
const totalPages = Math.ceil(total / 12);

if (page > totalPages && totalPages > 0) {
    return Astro.redirect(getEventsIndexUrl());
}
---

<EventListPage page={page} locals={Astro.locals} />
