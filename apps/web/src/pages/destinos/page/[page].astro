---
import DestinationListPage from '@/components/pages/DestinationListPage.astro';
import { getDestinations } from '@/data/db/destinations';
import { getDestinationsIndexUrl } from '@/utils/urls';

const { page: pageParam } = Astro.params;
const page = Number(pageParam) || 1;

// Redirect page 1 to the main index
if (page === 1) {
    return Astro.redirect(getDestinationsIndexUrl());
}

// Check if page is out of bounds
const { total } = await getDestinations({
    locals: Astro.locals,
    page: 1,
    pageSize: 12,
});
const totalPages = Math.ceil(total / 12);

if (page > totalPages && totalPages > 0) {
    return Astro.redirect(getDestinationsIndexUrl());
}
---

<DestinationListPage page={page} locals={Astro.locals} />
