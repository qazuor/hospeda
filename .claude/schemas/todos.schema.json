{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://hospeda.dev/schemas/todos.schema.json",
  "title": "TODOs Document",
  "description": "JSON Schema for validating TODOs documents with atomized tasks",
  "type": "object",
  "required": ["metadata", "summary", "phases", "tasks"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["planningCode", "relatedPDR", "relatedTechAnalysis", "version"],
      "properties": {
        "planningCode": {
          "type": "string",
          "pattern": "^P(F|R)?\\d{3,4}$"
        },
        "relatedPDR": {
          "type": "string",
          "description": "Path to related PDR document"
        },
        "relatedTechAnalysis": {
          "type": "string",
          "description": "Path to related tech-analysis document"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+(\\.\\d+)?$"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "summary": {
      "type": "object",
      "required": ["totalTasks", "totalPhases", "totalHours", "completedTasks"],
      "properties": {
        "totalTasks": {
          "type": "integer",
          "minimum": 1
        },
        "totalPhases": {
          "type": "integer",
          "minimum": 1
        },
        "totalHours": {
          "type": "number",
          "minimum": 0.5
        },
        "completedTasks": {
          "type": "integer",
          "minimum": 0
        },
        "completedHours": {
          "type": "number",
          "minimum": 0
        },
        "percentComplete": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "phases": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "name", "description", "estimatedHours", "tasks"],
        "properties": {
          "id": {
            "type": "integer",
            "minimum": 1
          },
          "name": {
            "type": "string",
            "minLength": 3
          },
          "description": {
            "type": "string",
            "minLength": 10
          },
          "estimatedHours": {
            "type": "number",
            "minimum": 0.5
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"]
          },
          "status": {
            "type": "string",
            "enum": ["pending", "in-progress", "completed", "blocked"],
            "default": "pending"
          },
          "tasks": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^PF\\d{3,4}(-\\d+)?(\\.\\d+)?$"
            },
            "description": "Task codes belonging to this phase"
          },
          "blockingFor": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "description": "Phase IDs that are blocked by this phase"
          }
        }
      }
    },
    "tasks": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["code", "title", "description", "estimatedHours", "priority", "phase", "status"],
        "properties": {
          "code": {
            "type": "string",
            "pattern": "^PF\\d{3,4}(-\\d+)?(\\.\\d+)?$",
            "description": "Task code (e.g., PF004-1, PF004-2.1)"
          },
          "title": {
            "type": "string",
            "minLength": 5,
            "maxLength": 200
          },
          "description": {
            "type": "string",
            "minLength": 10
          },
          "estimatedHours": {
            "type": "number",
            "minimum": 0.5,
            "maximum": 4,
            "description": "Tasks must be atomized: 0.5-4 hours each"
          },
          "actualHours": {
            "type": "number",
            "minimum": 0
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"]
          },
          "phase": {
            "type": "integer",
            "minimum": 1,
            "description": "Phase ID this task belongs to"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "in-progress", "completed", "blocked", "skipped"],
            "default": "pending"
          },
          "dependencies": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^PF\\d{3,4}(-\\d+)?(\\.\\d+)?$"
            },
            "description": "Task codes that must complete before this task"
          },
          "canParallelize": {
            "type": "boolean",
            "default": false,
            "description": "Can be done in parallel with other tasks"
          },
          "assignedTo": {
            "type": "string",
            "description": "Agent or person assigned to this task"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["documentation", "code", "testing", "review", "deployment", "refactor", "research"]
            }
          },
          "githubIssue": {
            "type": "integer",
            "description": "Related GitHub issue number"
          },
          "startedAt": {
            "type": "string",
            "format": "date-time"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time"
          },
          "notes": {
            "type": "string"
          },
          "blockedBy": {
            "type": "string",
            "description": "Reason if task is blocked"
          }
        }
      }
    },
    "validation": {
      "type": "object",
      "properties": {
        "allTasksAtomized": {
          "type": "boolean",
          "description": "All tasks are 0.5-4 hours"
        },
        "noCyclicDependencies": {
          "type": "boolean",
          "description": "No circular dependencies detected"
        },
        "allDependenciesExist": {
          "type": "boolean",
          "description": "All referenced dependencies exist"
        },
        "totalHoursMatch": {
          "type": "boolean",
          "description": "Sum of task hours matches totalHours"
        }
      }
    }
  }
}
